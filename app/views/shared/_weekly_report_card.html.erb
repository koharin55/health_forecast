<div class="card rounded-2xl p-4 sm:p-6">
  <div class="flex items-center gap-3 mb-4">
    <div class="icon-gradient w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center">
      <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
      </svg>
    </div>
    <h3 class="text-base sm:text-lg font-bold text-slate-900">AI週次レポート</h3>
  </div>

  <% if @latest_report.present? %>
    <div class="mb-4">
      <p class="text-xs text-slate-500 mb-2">
        最終生成: <%= @latest_report.created_at.strftime('%m/%d(%a) %H:%M') %>
      </p>
      <div class="text-sm text-slate-700 line-clamp-3">
        <%= truncate(strip_tags(@latest_report.content.gsub(/^#+\s*/, '').gsub(/\*\*/, '')), length: 120) %>
      </div>
      <%= link_to weekly_report_path(@latest_report), class: "text-emerald-600 hover:text-emerald-700 text-sm font-medium inline-flex items-center mt-2" do %>
        続きを読む
        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      <% end %>
    </div>
  <% else %>
    <p class="text-sm text-slate-600 mb-4">
      健康データをAIが分析し、週次レポートを生成します。
    </p>
  <% end %>

  <%= link_to new_weekly_report_path, class: "btn-primary w-full py-3 rounded-xl font-bold inline-flex items-center justify-center" do %>
    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
    <span><%= @latest_report.present? ? '新しいレポートを生成' : '今週のレポートを生成' %></span>
  <% end %>

  <% if current_user.weekly_reports.count > 1 %>
    <div class="mt-3 text-center">
      <%= link_to weekly_reports_path, class: "text-slate-500 hover:text-slate-700 text-sm" do %>
        過去のレポートを見る →
      <% end %>
    </div>
  <% end %>
</div>
