<% if current_user.location_configured? %>
  <div class="card rounded-2xl p-4 sm:p-5 animate-fade-in-up">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg sm:text-xl font-bold text-slate-900 flex items-center gap-2">
        <span class="text-xl"><%= weather ? WeatherService.weather_icon(weather[:weather_code]) : "🌡️" %></span>
        現在の天気
      </h3>
      <span class="text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full">
        <%= current_user.location_name %>
      </span>
    </div>

    <% if weather %>
      <!-- メイン天気情報 -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3">
        <!-- 天気 -->
        <div class="bg-gradient-to-br from-sky-50 to-blue-100 rounded-xl p-3">
          <div class="text-3xl sm:text-4xl mb-1 text-center">
            <%= WeatherService.weather_icon(weather[:weather_code]) %>
          </div>
          <p class="text-center text-sm sm:text-base font-bold text-slate-800">
            <%= weather[:weather_description] %>
          </p>
        </div>

        <!-- 気温 -->
        <div class="bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl p-3">
          <p class="text-xs text-slate-500 mb-0.5 flex items-center gap-1">
            <span>🌡️</span>気温
          </p>
          <p class="text-2xl sm:text-3xl font-bold text-slate-900 mono">
            <%= weather[:temperature] %><span class="text-sm sm:text-base text-slate-600">&#8451;</span>
          </p>
        </div>

        <!-- 湿度 -->
        <div class="bg-gradient-to-br from-cyan-50 to-teal-100 rounded-xl p-3">
          <p class="text-xs text-slate-500 mb-0.5 flex items-center gap-1">
            <span>💧</span>湿度
          </p>
          <p class="text-2xl sm:text-3xl font-bold text-slate-900 mono">
            <%= weather[:humidity] %><span class="text-sm sm:text-base text-slate-600">%</span>
          </p>
        </div>

        <!-- 気圧 -->
        <div class="bg-gradient-to-br <%= weather[:pressure] && weather[:pressure] < 1005 ? 'from-red-50 to-rose-100' : 'from-purple-50 to-indigo-100' %> rounded-xl p-3">
          <p class="text-xs text-slate-500 mb-0.5 flex items-center gap-1">
            <span>🎈</span>気圧
          </p>
          <p class="text-2xl sm:text-3xl font-bold mono <%= pressure_class(weather[:pressure]) || 'text-slate-900' %>">
            <%= weather[:pressure]&.round(0) %><span class="text-sm sm:text-base text-slate-600">hPa</span>
          </p>
        </div>
      </div>

      <% if weather[:pressure] && weather[:pressure] < 1005 %>
        <div class="mt-3 p-2 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-sm">
          <span>&#9888;&#65039;</span>
          <span class="text-amber-800 font-medium">低気圧です。頭痛や体調不良にご注意ください。</span>
        </div>
      <% end %>
    <% else %>
      <div class="text-slate-500 text-center py-6">
        <span class="text-3xl block mb-1">🌐</span>
        天気情報を取得できませんでした。
      </div>
    <% end %>
  </div>
<% else %>
  <div class="card rounded-2xl p-4 sm:p-5 animate-fade-in-up">
    <div class="flex items-center gap-2 mb-3">
      <span class="text-2xl">🌤️</span>
      <h3 class="text-lg sm:text-xl font-bold text-slate-900">
        天気情報
      </h3>
    </div>
    <div class="bg-slate-50 rounded-xl p-3 text-center">
      <p class="text-slate-600 text-sm mb-2">
        地域を設定すると、天気情報が表示されます。
      </p>
      <%= link_to settings_path, class: "inline-flex items-center gap-1 btn-primary px-4 py-1.5 rounded-full font-semibold text-sm" do %>
        <span>📍</span> 地域を設定する
      <% end %>
    </div>
  </div>
<% end %>
