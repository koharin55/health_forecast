<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>PreCare</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#10b981">
    <meta name="description" content="Êó•„ÄÖ„ÅÆÂÅ•Â∫∑„Éá„Éº„Çø„ÇíË®òÈå≤„ÉªÁÆ°ÁêÜ„Åô„Çã„Ç¢„Éó„É™">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PreCare">
    <link rel="apple-touch-startup-image" href="/icons/icon-512x512.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <style>
      body {
        font-family: 'Zen Maru Gothic', sans-serif;
        position: relative;
        min-height: 100vh;
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfeff 50%, #fef3c7 100%);
        background-attachment: fixed;
        color: #475569;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image:
          radial-gradient(circle at 20% 30%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
      }

      main {
        position: relative;
        z-index: 1;
      }

      nav {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(16, 185, 129, 0.1);
      }
    </style>
  </head>

  <body>
    <% if user_signed_in? %>
      <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„Éº -->
      <nav class="sticky top-0 z-50" data-controller="mobile-menu">
        <div class="max-w-7xl mx-auto px-6 sm:px-10 lg:px-16">
          <div class="flex justify-between items-center h-16">
            <!-- „É≠„Ç¥ -->
            <div class="flex items-center">
              <%= link_to root_path, class: "logo text-xl sm:text-2xl font-extrabold flex items-center gap-1" do %>
                <span>üåø</span>PreCare
              <% end %>
            </div>

            <!-- „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
            <div class="hidden md:flex items-center flex-1 ml-8">
              <!-- Â∑¶: „Éö„Éº„Ç∏„Éä„Éì -->
              <div class="flex items-center space-x-6">
                <%= link_to "„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ", root_path, class: "text-slate-600 hover:text-emerald-600 font-medium transition-colors" %>
                <%= link_to "Ë®òÈå≤‰∏ÄË¶ß", health_records_path, class: "text-slate-600 hover:text-emerald-600 font-medium transition-colors" %>
                <%= link_to new_health_record_path, class: "btn-primary text-white px-5 py-2.5 rounded-full font-semibold" do %>
                  Êñ∞Ë¶èË®òÈå≤
                <% end %>
              </div>
              <!-- Âè≥: „É¶„Éº„Ç∂„Éº„Ç®„É™„Ç¢ -->
              <div class="flex items-center space-x-3 ml-auto pl-6">
                <span class="text-sm text-slate-500"><%= current_user.time_based_greeting %>„ÄÅ<%= link_to "#{current_user.nickname || '„Ç≤„Çπ„Éà'}„Åï„Çì", mypage_path, class: "font-medium text-slate-600 hover:text-emerald-600 transition-colors" %></span>
                <span class="text-slate-300">|</span>
                <%= button_to "„É≠„Ç∞„Ç¢„Ç¶„Éà", destroy_user_session_path, method: :delete, class: "text-sm text-slate-500 hover:text-slate-900 transition-colors bg-transparent border-0 cursor-pointer" %>
              </div>
            </div>

            <!-- „É¢„Éê„Ç§„É´„É°„Éã„É•„Éº„Éú„Çø„É≥ -->
            <button class="md:hidden btn-primary text-white p-3 rounded-xl ml-4 shrink-0" data-action="click->mobile-menu#toggle" aria-label="„É°„Éã„É•„Éº">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
            </button>
          </div>

          <!-- „É¢„Éê„Ç§„É´„É°„Éã„É•„Éº -->
          <div class="mobile-menu md:hidden py-4 space-y-3" data-mobile-menu-target="menu" style="display: none;">
            <%= link_to "„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ", root_path, class: "block py-3 px-4 rounded-xl text-slate-600 font-medium hover:bg-slate-50 transition-colors", data: { action: "click->mobile-menu#toggle" } %>
            <%= link_to "Ë®òÈå≤‰∏ÄË¶ß", health_records_path, class: "block py-3 px-4 rounded-xl text-slate-600 font-medium hover:bg-slate-50 transition-colors", data: { action: "click->mobile-menu#toggle" } %>
            <%= link_to "„Éû„Ç§„Éö„Éº„Ç∏", mypage_path, class: "block py-3 px-4 rounded-xl text-slate-600 font-medium hover:bg-slate-50 transition-colors", data: { action: "click->mobile-menu#toggle" } %>
            <%= link_to "Êñ∞Ë¶èË®òÈå≤", new_health_record_path, class: "block py-3 px-4 rounded-xl btn-primary text-white font-bold text-center", data: { action: "click->mobile-menu#toggle" } %>
            <%= button_to "„É≠„Ç∞„Ç¢„Ç¶„Éà", destroy_user_session_path, method: :delete, class: "block w-full py-3 px-4 rounded-xl text-slate-600 font-medium hover:bg-slate-50 text-left transition-colors bg-transparent border-0" %>
          </div>
        </div>
      </nav>
    <% end %>

    <!-- „Ç¢„É©„Éº„Éà -->
    <% if notice.present? %>
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4 relative z-10">
        <div class="alert alert-success rounded-2xl" role="alert">
          <span class="block sm:inline"><%= notice %></span>
        </div>
      </div>
    <% end %>

    <% if alert.present? %>
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4 relative z-10">
        <div class="alert alert-error rounded-2xl" role="alert">
          <span class="block sm:inline"><%= alert %></span>
        </div>
      </div>
    <% end %>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="<%= user_signed_in? ? 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-12' : '' %>">
      <%= yield %>
    </main>

    <% if user_signed_in? %>
      <!-- „Éï„ÉÉ„Çø„Éº -->
      <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6 relative z-10">
        <div class="card rounded-2xl px-4 py-6 text-center text-slate-600">
          <p class="text-sm">&copy; 2026 PreCare. All rights reserved.</p>
        </div>
      </footer>
    <% end %>
  </body>
</html>
