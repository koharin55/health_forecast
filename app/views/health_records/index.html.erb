<div class="w-full">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
    <h1 class="text-3xl font-bold text-slate-700">健康記録一覧</h1>
    <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
      <%= link_to export_health_records_path, class: "btn-secondary w-full md:w-auto px-4 py-3 rounded-xl font-bold inline-flex items-center justify-center" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        <span>エクスポート</span>
      <% end %>
      <%= link_to import_health_records_path, class: "btn-secondary w-full md:w-auto px-4 py-3 rounded-xl font-bold inline-flex items-center justify-center" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
        </svg>
        <span>インポート</span>
      <% end %>
      <%= link_to new_health_record_path, class: "btn-primary w-full md:w-auto px-6 py-3 rounded-xl font-bold inline-flex items-center justify-center" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        <span>新規記録</span>
      <% end %>
    </div>
  </div>

  <% if @health_records.any? %>
    <!-- モバイル：カードビュー -->
    <div class="grid grid-cols-1 md:hidden gap-4">
      <% @health_records.each do |record| %>
        <div class="card p-5">
          <div class="flex justify-between items-start mb-4">
            <div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.recorded_at.strftime("%Y-%m-%d") %>
              </div>
              <div class="text-xs text-slate-500 mt-1">
                <%= record.recorded_at.strftime("%A") %>
              </div>
            </div>
            <% if record.mood.present? %>
              <span class="<%= mood_badge_class(record.mood) %>">
                <%= mood_emoji(record.mood) %>
                <%= mood_text(record.mood) %>
              </span>
            <% end %>
          </div>

          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">血圧</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <% if record.systolic_pressure.present? && record.diastolic_pressure.present? %>
                  <%= "#{record.systolic_pressure}/#{record.diastolic_pressure}" %>
                  <span class="text-xs text-slate-500 font-normal">mmHg</span>
                <% else %>
                  ➖
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">心拍数</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.heart_rate.present? ? "#{record.heart_rate}" : "➖" %>
                <% if record.heart_rate.present? %>
                  <span class="text-xs text-slate-500 font-normal">bpm</span>
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">体温</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.body_temperature.present? ? "#{record.body_temperature}" : "➖" %>
                <% if record.body_temperature.present? %>
                  <span class="text-xs text-slate-500 font-normal">℃</span>
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">睡眠</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.sleep_hours.present? ? "#{record.sleep_hours}" : "➖" %>
                <% if record.sleep_hours.present? %>
                  <span class="text-xs text-slate-500 font-normal">h</span>
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">体重</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.weight.present? ? "#{record.weight}" : "➖" %>
                <% if record.weight.present? %>
                  <span class="text-xs text-slate-500 font-normal">kg</span>
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">運動</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.exercise_minutes.present? ? "#{record.exercise_minutes}" : "➖" %>
                <% if record.exercise_minutes.present? %>
                  <span class="text-xs text-slate-500 font-normal">分</span>
                <% end %>
              </div>
            </div>

            <div class="bg-white bg-opacity-50 rounded-lg p-3">
              <div class="text-xs text-slate-500 mb-1">歩数</div>
              <div class="text-lg font-bold text-slate-800 mono">
                <%= record.steps.present? ? number_with_delimiter(record.steps) : "➖" %>
              </div>
            </div>
          </div>

          <% if record.has_weather_data? %>
            <div class="bg-sky-50 rounded-lg p-3 mb-4">
              <div class="flex items-center gap-2 text-sm text-slate-700">
                <span class="text-lg"><%= record.weather_icon %></span>
                <span><%= record.weather_description %></span>
                <span class="text-slate-500">|</span>
                <span><%= record.weather_temperature %>&#8451;</span>
                <span class="text-slate-500">|</span>
                <span class="<%= pressure_class(record.weather_pressure) %>"><%= record.weather_pressure&.round(0) %>hPa</span>
              </div>
            </div>
          <% end %>

          <div class="flex gap-2">
            <%= link_to "詳細", record, class: "btn-secondary flex-1 text-center text-sm py-2" %>
            <%= link_to "編集", edit_health_record_path(record), class: "btn-primary flex-1 text-center text-sm py-2" %>
            <%= button_to "削除", record, method: :delete,
                class: "w-full text-center text-sm py-2 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-xl transition",
                form: { class: "flex-1" },
                data: { turbo_confirm: "本当に削除しますか？" } %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- デスクトップ：テーブルビュー -->
    <div class="card rounded-2xl hidden md:block overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50 bg-opacity-50">
            <tr>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">日付</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">天気</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">血圧</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">心拍</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">体温</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">睡眠</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">体重</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">運動</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">歩数</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">体調</th>
              <th class="px-3 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">操作</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% @health_records.each do |record| %>
              <tr class="hover:bg-gray-50 hover:bg-opacity-50 transition">
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 font-medium mono text-center">
                  <%= record.recorded_at.strftime("%Y-%m-%d") %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 text-center">
                  <% if record.has_weather_data? %>
                    <span title="<%= record.weather_description %> <%= record.weather_temperature %>℃ <%= record.weather_pressure&.round(0) %>hPa">
                      <%= record.weather_icon %>
                      <span class="<%= pressure_class(record.weather_pressure) %>"><%= record.weather_pressure&.round(0) %></span>
                    </span>
                  <% else %>
                    ➖
                  <% end %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <% if record.systolic_pressure.present? && record.diastolic_pressure.present? %>
                    <%= "#{record.systolic_pressure}/#{record.diastolic_pressure}" %>
                  <% else %>
                    ➖
                  <% end %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.heart_rate.present? ? record.heart_rate : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.body_temperature.present? ? "#{record.body_temperature}℃" : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.sleep_hours.present? ? "#{record.sleep_hours}h" : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.weight.present? ? record.weight : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.exercise_minutes.present? ? "#{record.exercise_minutes}分" : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 mono text-center">
                  <%= record.steps.present? ? number_with_delimiter(record.steps) : "➖" %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-slate-900 text-center">
                  <% if record.mood.present? %>
                    <span class="<%= mood_badge_class(record.mood) %>">
                      <%= mood_emoji(record.mood) %>
                      <%= mood_text(record.mood) %>
                    </span>
                  <% else %>
                    ➖
                  <% end %>
                </td>
                <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-center">
                  <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <%= link_to "詳細", record, class: "btn-action btn-action-view" %>
                    <%= link_to "編集", edit_health_record_path(record), class: "btn-action btn-action-edit" %>
                    <%= button_to "削除", record, method: :delete,
                        class: "btn-action btn-action-delete",
                        form: { style: "display: inline;" },
                        data: { turbo_confirm: "本当に削除しますか？" } %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% else %>
    <div class="card p-12">
      <p class="text-slate-600 text-center">
        まだ記録がありません。<%= link_to "最初の記録を追加", new_health_record_path, class: "text-emerald-600 hover:text-emerald-900 font-semibold" %>しましょう！
      </p>
    </div>
  <% end %>
</div>
