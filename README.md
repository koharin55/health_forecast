# HealthForecast - 健康管理アプリケーション

HealthForecastは、日々の健康データを記録・可視化し、将来的にAIを活用した体調予測やアドバイスを提供する健康管理アプリケーションです。

## 概要

このアプリケーションは、以下の会話内容に基づいて設計された健康管理システムの第一フェーズ（MVP版）です：

- PCとスマホ両方で閲覧可能なレスポンシブデザイン
- 手動入力による健康データの記録
- データのグラフ表示と簡単な統計
- 将来的なApple Health/HealthKit連携の準備
- AI機能追加の基盤

## 主な機能

### 現在実装済みの機能

1. **ユーザー認証**
   - メールアドレスとパスワードによるユーザー登録・ログイン
   - Deviseを使用したセキュアな認証システム

2. **健康データ記録**
   - 体重（kg）
   - 睡眠時間（時間）
   - 運動時間（分）
   - 体調スコア（1-5段階）
   - 歩数
   - 心拍数（bpm）
   - 血圧（収縮期/拡張期 mmHg）
   - 体温（℃）
   - メモ（自由記述）

3. **天候情報連携**
   - Open-Meteo APIによる天候データ自動取得
   - 健康記録保存時に天候情報を自動記録（気温、湿度、気圧、天気）
   - 地域設定（都道府県選択または郵便番号入力）
   - 過去データへの天候情報バックフィル機能（92日以内）
   - ダッシュボードに現在の天気を表示

4. **ダッシュボード**
   - 統計サマリー（総記録数、最新の体重・体調）
   - グラフ表示（体重、睡眠時間、体調スコア、運動時間の推移）
   - 現在の天気情報表示
   - 最近の記録一覧

5. **記録管理**
   - 記録の一覧表示（天候情報含む）
   - 記録の詳細表示
   - 記録の編集・削除

6. **PWA対応**
   - ホーム画面への追加
   - プッシュ通知機能

### 今後追加予定の機能

- Apple Health / HealthKitからのデータ自動連携（iOSアプリ開発）
- AIによる体調予測とアラート機能（天候データとの相関分析）
- 過去データの詳細分析とレポート生成
- パーソナライズされた健康アドバイスとTips

## 技術スタック

- **フレームワーク**: Ruby on Rails 7.1.6
- **Ruby**: 3.2.0
- **データベース**: SQLite3（開発環境）
- **認証**: Devise 5.0.0
- **フロントエンド**:
  - Tailwind CSS（レスポンシブデザイン）
  - Hotwire (Turbo & Stimulus)
  - Chartkick（グラフ表示）
- **データ分析**: Groupdate
- **外部API**:
  - Open-Meteo API（天候データ取得、無料・APIキー不要）
  - Zipcloud API（郵便番号→住所変換）
- **テスト**: RSpec, WebMock

## セットアップ手順

### 前提条件

- Ruby 3.2.0
- Rails 7.1.6
- SQLite3

### インストール

1. リポジトリのクローン（または既存ディレクトリで作業）

```bash
cd health_forecast
```

2. 依存関係のインストール

```bash
bundle install
```

3. データベースのセットアップ

```bash
rails db:create
rails db:migrate
```

4. サーバーの起動

```bash
bin/dev
```

または

```bash
rails server
```

5. ブラウザで http://localhost:3000 にアクセス

## 使い方

1. **ユーザー登録**
   - トップページから「Sign up」をクリック
   - メールアドレスとパスワードを入力して登録

2. **ログイン**
   - 登録したメールアドレスとパスワードでログイン

3. **健康記録の追加**
   - ダッシュボードまたは「健康記録」ページから「新しい記録を追加」をクリック
   - 記録日と各種健康データを入力
   - 「記録を追加」ボタンで保存

4. **データの閲覧**
   - ダッシュボード：最近の記録とグラフで推移を確認
   - 健康記録一覧：すべての記録を一覧表示
   - 詳細表示：個別の記録を詳しく確認

5. **記録の編集・削除**
   - 各記録の「編集」ボタンでデータを修正
   - 「削除」ボタンで不要な記録を削除

## データモデル

### User（ユーザー）
- email（メールアドレス）
- encrypted_password（暗号化パスワード）
- latitude（緯度）※地域設定用
- longitude（経度）※地域設定用
- location_name（地域名）※表示用

### HealthRecord（健康記録）
- user_id（ユーザーID）
- recorded_at（記録日）
- weight（体重）
- sleep_hours（睡眠時間）
- exercise_minutes（運動時間）
- mood（体調スコア 1-5）
- notes（メモ）
- steps（歩数）
- heart_rate（心拍数）
- systolic_pressure（収縮期血圧）
- diastolic_pressure（拡張期血圧）
- body_temperature（体温）
- weather_temperature（天気: 気温）
- weather_humidity（天気: 湿度）
- weather_pressure（天気: 気圧）
- weather_code（天気: WMOコード）
- weather_description（天気: 説明）

## 開発のロードマップ

### フェーズ1（完了）
✅ Rails Web版の基本機能
✅ ユーザー認証
✅ 手動入力によるデータ記録
✅ グラフ表示と簡単な分析
✅ レスポンシブデザイン

### フェーズ2（完了）
✅ PWA化（ホーム画面追加）
✅ プッシュ通知機能
✅ 天候情報連携（Open-Meteo API）
✅ 地域設定（都道府県/郵便番号）
✅ 過去データ天候バックフィル

### フェーズ3（予定）
- Claude APIまたはOpenAI APIを使用したAI分析
- 天候データと体調の相関分析
- パーソナライズされたアドバイス生成
- 体調予測機能（天気予報連携）

### フェーズ4（予定）
- iOSアプリ開発（Swift）
- HealthKit連携
- データの自動同期

## デプロイ

本番環境へのデプロイ時は、以下の設定が必要です：

1. 環境変数の設定
   - `SECRET_KEY_BASE`
   - データベース接続情報（本番環境ではPostgreSQLを推奨）

2. アセットのプリコンパイル

```bash
RAILS_ENV=production rails assets:precompile
```

3. データベースマイグレーション

```bash
RAILS_ENV=production rails db:migrate
```

## ライセンス

このプロジェクトは個人開発プロジェクトです。

## 貢献

個人プロジェクトですが、改善提案やバグ報告は歓迎します。

## お問い合わせ

質問や提案がある場合は、プロジェクトのIssueまでお願いします。

---

**注意**: 本アプリケーションは医療アドバイスを提供するものではありません。健康上の懸念がある場合は、必ず医療専門家にご相談ください。
